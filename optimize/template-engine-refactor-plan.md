# 專案架構優化建議：引入模板引擎

## 前言

為了提升 `my-book-library` 專案的長期可維護性，解決目前多頁面應用 (MPA) 架構下，需手動同步所有 HTML 檔案共通內容（如 `<head>` 區塊、GTM 追蹤碼、頁尾等）的問題，建議引入模板引擎機制。

此文件將分析兩種主流的實作方案，並提供最終建議。

---

## 方案一：使用模板引擎（建置期方案，推薦）

此方案是業界處理靜態網站的標準與最佳實踐。

### 原理

在「建置階段」(Build-Time)，透過 Vite 外掛程式 (如 `vite-plugin-handlebars`)，自動將預先定義好的共用 HTML 片段 (Partials) 組裝到每一個頁面中。最終產出的 `dist` 目錄中的 HTML 檔案都是已經包含共通內容的完整靜態檔案。

### 預計步驟

1.  **安裝 Vite 外掛**：
    ```bash
    npm install vite-plugin-handlebars --save-dev
    ```
2.  **設定 Vite**：
    修改 `vite.config.ts`，引入並啟用 `vite-plugin-handlebars` 外掛。
3.  **建立共用元件 (Partials)**：
    -   建立新目錄 `src/partials/`。
    -   在此目錄中，建立共通的 HTML 片段檔案：
        -   `_header.html`: 包含所有頁面共通的 `<head>` 內容（`<meta>` 標籤、CSS 連結、GTM 追蹤碼等）。
        -   `_footer.html`: 包含共通的頁尾資訊或共用的 JavaScript 腳本。
4.  **重構頁面模板**：
    -   修改專案中所有的 HTML 檔案 (`index.html` 及 `bookshelf/` 下的檔案)。
    -   將原本重複的 `<head>` 和 `<body>` 開頭/結尾部分，替換為模板引擎的引用指令（例如 `{{> _header }}`）。
    -   使每個頁面檔案只保留其獨特的內容，大幅簡化檔案結構。

### 優點

-   **SEO 友好**：最終產出的 HTML 是完整的靜態檔案，對搜尋引擎爬蟲最友善。
-   **效能最佳**：瀏覽器載入頁面時無需額外執行 JavaScript 來組裝頁面，載入速度最快，使用者體驗最好。
-   **結構清晰**：程式碼可讀性高，易於長期維護。

---

## 方案二：使用 JavaScript 動態載入（客戶端方案）

此方案將組合頁面的工作交給使用者的瀏覽器。

### 原理

每個頁面先載入一個「骨架」HTML，然後透過一段共用的 JavaScript 程式碼，在瀏覽器端 (Client-Side) 使用 `fetch` API 去抓取共通的 HTML 片段 (如 `header.html`, `footer.html`)，再動態地將其內容插入到頁面的指定位置。

### 預計步驟

1.  **建立 HTML 片段**：
    建立 `partials/header.html` 等檔案，存放如導覽列等共通的 HTML 結構。
2.  **撰寫載入腳本**：
    -   建立一個新的 TypeScript 檔案 (e.g., `src/ts/layout-loader.ts`)。
    -   腳本的任務是：找到頁面中預設的佔位符 (e.g., `<div id="header-placeholder"></div>`)，`fetch` 對應的 HTML 片段，並透過 `innerHTML` 插入內容。
3.  **在所有頁面引入腳本**：
    手動在每一個 HTML 檔案中加入 `<script>` 標籤，來引用上述的載入腳本。

### 缺點

-   **不利於 SEO**：搜尋引擎爬蟲可能不會等待 JS 執行完畢，導致無法讀取到完整的頁面內容。
-   **可能產生畫面閃爍 (FOUC)**：在 JS 載入並執行完畢前，頁面的共通區塊會是空白的，造成視覺上的延遲與不連貫。
-   **增加客戶端負擔**：將組合頁面的工作交給了使用者的瀏覽器，而非在建置階段就完成。

---

## 結論與建議

考量到您的專案已經在使用 Vite 這個強大的建置工具，**強烈建議您採用方案一：使用模板引擎**。

這能完美融入您現有的開發流程，並且產出效能與 SEO 表現都最佳的網站。雖然初次設定會比方案二多一兩個步驟，但從長期的可維護性與專案的健全度來看，是更優異的選擇。
